# Exploiting GPOs
Through Exploiting AD Users, we were able to decrypt the credential database which provided us with credentials that can be used for further AD exploitation. 
- `SvcServMan` account
- Find out what `svcServMan` credentials are used for
- Use Bloodhound

svcservman1

### First Degree Object Control
- Indicates that the user/entity has a direct level of control of objects within AD
- Control might involve permissions to modify, delete, or manipulate specific AD objects

- SVCSERVMAN@ZA.TRYHACKME.LOC has ownership over Group Policy Object
- GPO is applied to THMSERVER2 machine

svcservman2

## Group Policy Objects
SYSVOL directory is a central role in the replication of GPOs and logon scripts across domain controllers in AD domain.  

#### GPO Storage
- Stores the contents of GPOs, including settings and scripts

#### Replication
- Facilitates the replication of this information between domain controllers in the same AD domain
- Ensures all domain controllers have consistent and up-to-date GPOs

#### GPO
- Virtual collection of policy settings
- Each GPO has a unique name; GUID

Each Windows computer has a Local Policy configuration. Contains several notable configurations such as:  
- Application configuration for services such as Firewall, Anti-Virus, and Applocker
- Local Group Membership such as Admin or Remote Desktop Users groups
- Startup configuration such as scripts that should be executed
- Security and protcol settings such as SMBV1 support

## Group Policy Management
- Define policies directly on the AD structure  
- Define GPOs for AD objects, such as OU or group  
- Domain-joined computers would pull the policies from SYSVOL and apply relevant ones  
- Policies are replicated every 15 minutes through gpupdate  

## Exploiting GPOs
- Many ways to exploit GPOs  
- We will add an AD account (we control) to both local Administrators and local Remote Desktop Users groups  
- Allow admin privileges on THMSERVER2 and the ability to RDP in  

To modify GPO, we need to access the Group Policy Management as the AD user that has the relevant permissions.  
- RDP into THMWRK1 with normal or Tier 2 Admin  
- Inject SVCSERVMAN credentials into memory using runas command  
- Open MMC to modify GPO  

In MMC:  
1. File > Add/Remove Snap-in  
2. Select Group Policy Management snap-in and click Add  
3. Select Ok

mmc1

Navigate to GPO that our user has permission to modify (Servers > Management Servers > Management Server Pushes):

mmc2

> Computer Configuration  
> Policies  
> Windows Settings  
> Security Settings  
> Right Click on Restricted Groups + Select Add Group  
> Add IT Support Group to Restricted Group  
> Add IT Support Group to Administrators and Remote Desktop Users Groups  

mmc3

- Apply `gpupdate`
- User account that is member of `IT Support` will now have admin privileges and RDP permissions on THMSERVER2